# üìö –®–ø–∞—Ä–≥–∞–ª–∫–∞ –¥–ª—è –°–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–π –≤ FAANG
## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–æ Code Review: –û—Ç –¢–µ–æ—Ä–∏–∏ –∫ –†–µ–∞–ª—å–Ω—ã–º –ö–µ–π—Å–∞–º

**–ê–≤—Ç–æ—Ä**: AI Assistant
**–¶–µ–ª—å**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è–º –≤ FAANG (Google, Meta, Amazon, Apple, Netflix)
**–Ø–∑—ã–∫**: –†—É—Å—Å–∫–∏–π
**–£—Ä–æ–≤–µ–Ω—å**: Middle - Senior

---

# üéØ –ß–ê–°–¢–¨ 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

## 1. –£—Ç–µ—á–∫–∞ –ü–∞—Ä–æ–ª–µ–π –≤ –õ–æ–≥–∞—Ö

### üìñ –¢–µ–æ—Ä–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞**: –í—ã–≤–æ–¥ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã, –∫–ª—é—á–∏ API) –≤ –ª–æ–≥–∏, –∫–æ–Ω—Å–æ–ª—å –∏–ª–∏ error tracking —Å–∏—Å—Ç–µ–º—ã.

**–ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ**:
- –õ–æ–≥–∏ —á–∞—Å—Ç–æ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ plain text
- –î–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º –∏–º–µ—é—Ç DevOps, SRE, –∏–Ω–æ–≥–¥–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –õ–æ–≥–∏ –º–æ–≥—É—Ç –ø–æ–ø–∞–¥–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Splunk, ELK, Datadog)
- –õ–æ–≥–∏ –º–æ–≥—É—Ç –±—ç–∫–∞–ø–∏—Ç—å—Å—è –∏ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≥–æ–¥–∞–º–∏

### üî¥ –†–µ–∞–ª—å–Ω—ã–π –ö–µ–π—Å #1: Uber (2016)
**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ**:
- –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ Uber —Ö—Ä–∞–Ω–∏–ª–∏ AWS –∫–ª—é—á–∏ –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –ë—ã–≤—à–∏–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–∫–∞—á–∞–ª –∫–æ–¥ –∏ –Ω–∞—à–µ–ª –∫—Ä–µ–¥—ã –≤ –ª–æ–≥–∞—Ö
- –ë—ã–ª–∏ —É–∫—Ä–∞–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ **57 –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –∏ 600,000 –≤–æ–¥–∏—Ç–µ–ª–µ–π
- Uber –∑–∞–ø–ª–∞—Ç–∏–ª —Ö–∞–∫–µ—Ä–∞–º $100,000 —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
- –ü–æ–∑–∂–µ –∫–æ–º–ø–∞–Ω–∏—è –∑–∞–ø–ª–∞—Ç–∏–ª–∞ —à—Ç—Ä–∞—Ñ **$148 –º–∏–ª–ª–∏–æ–Ω–æ–≤**

**–ß—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫**:
```python
# ‚ùå –ü–õ–û–•–û - —Ç–∞–∫ –¥–µ–ª–∞–ª–∏ –≤ Uber
logger.error(f"Failed to connect to AWS: {aws_credentials}")
# –ö—Ä–µ–¥—ã –ø–æ–ø–∞–ª–∏ –≤ CloudWatch Logs
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**:
```python
# ‚úÖ –•–û–†–û–®–û
def sanitize_config(config: Dict[str, Any]) -> Dict[str, Any]:
    """Mask sensitive fields before logging."""
    sensitive_fields = ['password', 'token', 'api_key', 'secret', 'credential']
    sanitized = config.copy()
    for key in sanitized:
        if any(field in key.lower() for field in sensitive_fields):
            sanitized[key] = '***REDACTED***'
    return sanitized

logger.error(f"Failed to connect: {sanitize_config(config)}")
```

### üî¥ –†–µ–∞–ª—å–Ω—ã–π –ö–µ–π—Å #2: Twitter (2018)
**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ**:
- Twitter —Ö—Ä–∞–Ω–∏–ª –ø–∞—Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ **plain text –≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ª–æ–≥–∞—Ö**
- –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã **330 –º–∏–ª–ª–∏–æ–Ω–æ–≤ –∞–∫–∫–∞—É–Ω—Ç–æ–≤**
- –ü–∞—Ä–æ–ª–∏ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
- –ú–∞—Å—à—Ç–∞–±–Ω–∞—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª–µ–π

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —É—â–µ—Ä–±
- –†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–æ–≤
- –ú–∞—Å—Å–æ–≤–∞—è –ø–æ—Ç–µ—Ä—è –¥–æ–≤–µ—Ä–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–£—Ä–æ–∫**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å credentials, –¥–∞–∂–µ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã.

### üí° –í–æ–ø—Ä–æ—Å—ã –Ω–∞ –°–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

**Q1**: "–ö–∞–∫ –±—ã –≤—ã —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–∫–∏ credentials?"

<details>
<summary>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –û—Ç–≤–µ—Ç</summary>

```python
import logging
import re
from typing import Any

class SanitizingFormatter(logging.Formatter):
    """Custom formatter that redacts sensitive data."""

    SENSITIVE_PATTERNS = [
        (re.compile(r'password["\s:=]+([^\s&"]+)', re.I), r'password=***'),
        (re.compile(r'token["\s:=]+([^\s&"]+)', re.I), r'token=***'),
        (re.compile(r'api[_-]?key["\s:=]+([^\s&"]+)', re.I), r'api_key=***'),
        (re.compile(r'\b[A-Za-z0-9+/]{32,}={0,2}\b'), r'***BASE64***'),
    ]

    def format(self, record: logging.LogRecord) -> str:
        original = super().format(record)
        sanitized = original
        for pattern, replacement in self.SENSITIVE_PATTERNS:
            sanitized = pattern.sub(replacement, sanitized)
        return sanitized

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
handler = logging.StreamHandler()
handler.setFormatter(SanitizingFormatter('%(asctime)s - %(message)s'))
logger = logging.getLogger(__name__)
logger.addHandler(handler)
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã**:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Secret Management —Å–∏—Å—Ç–µ–º—ã (HashiCorp Vault, AWS Secrets Manager)
2. –†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ –∫–∞–∂–¥—ã–µ 30-90 –¥–Ω–µ–π
3. –ê—É–¥–∏—Ç –ª–æ–≥–æ–≤ —Å –ø–æ–º–æ—â—å—é automated scanners
4. –û—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ production –ª–æ–≥–∞–º
5. Encryption at rest –¥–ª—è –≤—Å–µ—Ö –ª–æ–≥–æ–≤
</details>

**Q2**: "–í—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏, —á—Ç–æ –ø–∞—Ä–æ–ª–∏ –ø–æ–ø–∞–ª–∏ –≤ Sentry/error tracking. –í–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è?"

<details>
<summary>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –û—Ç–≤–µ—Ç</summary>

**–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è** (–ø–µ—Ä–≤—ã–µ 15 –º–∏–Ω—É—Ç):
1. **–£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Sentry**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Data Scrubbing –∏–ª–∏ –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
2. **–†–æ—Ç–∞—Ü–∏—è —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö credentials**: –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª–µ–π
3. **–£–≤–µ–¥–æ–º–∏—Ç—å Security Team**: Incident response –ø—Ä–æ—Ü–µ–¥—É—Ä–∞

**–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è** (24 —á–∞—Å–∞):
1. –ê—É–¥–∏—Ç –≤—Å–µ—Ö –ª–æ–≥–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
2. –§–æ—Ä—Å —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª–µ–π –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
4. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π

**–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ Sentry before_send hook
import sentry_sdk

def before_send(event, hint):
    """Scrub sensitive data before sending to Sentry."""
    if 'request' in event:
        # –£–¥–∞–ª–∏—Ç—å authorization headers
        event['request'].get('headers', {}).pop('Authorization', None)
        event['request'].get('headers', {}).pop('Cookie', None)

    # –°–∫—Ä—ã—Ç—å env variables
    if 'contexts' in event and 'runtime' in event['contexts']:
        env = event['contexts']['runtime'].get('env', {})
        for key in list(env.keys()):
            if any(s in key.lower() for s in ['password', 'secret', 'key', 'token']):
                env[key] = '***'

    return event

sentry_sdk.init(
    dsn="...",
    before_send=before_send
)
```

**Post-mortem –¥–æ–∫—É–º–µ–Ω—Ç**:
- Root cause analysis
- Timeline —Å–æ–±—ã—Ç–∏–π
- Preventive measures
- Action items with owners
</details>

---

## 2. SQL Injection

### üìñ –¢–µ–æ—Ä–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ user input –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é –≤ SQL –∑–∞–ø—Ä–æ—Å–∞—Ö –±–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

**–¢–∏–ø—ã SQL Injection**:
1. **Classic SQL Injection**: `SELECT * FROM users WHERE id = '1 OR 1=1'`
2. **Blind SQL Injection**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
3. **Second-Order Injection**: –í—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∑–∂–µ

### üî¥ –†–µ–∞–ª—å–Ω—ã–π –ö–µ–π—Å #1: Target (2013)
**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ**:
- –•–∞–∫–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ SQL injection –≤ —Å–∏—Å—Ç–µ–º–µ HVAC –ø–æ–¥—Ä—è–¥—á–∏–∫–∞
- –ü–æ–ª—É—á–∏–ª–∏ –¥–æ—Å—Ç—É–ø –∫ Point-of-Sale —Å–∏—Å—Ç–µ–º–∞–º Target
- –£–∫—Ä–∞–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ **40 –º–∏–ª–ª–∏–æ–Ω–æ–≤ –∫—Ä–µ–¥–∏—Ç–Ω—ã—Ö –∫–∞—Ä—Ç**
- –°–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω—ã –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ **70 –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π**

**–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –ü—Ä—è–º—ã–µ —É–±—ã—Ç–∫–∏: **$292 –º–∏–ª–ª–∏–æ–Ω–∞**
- –®—Ç—Ä–∞—Ñ—ã –±–∞–Ω–∫–æ–≤: **$39 –º–∏–ª–ª–∏–æ–Ω–æ–≤**
- –£—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏: **$18.5 –º–∏–ª–ª–∏–æ–Ω–æ–≤**
- CEO –∫–æ–º–ø–∞–Ω–∏–∏ —É–≤–æ–ª–µ–Ω
- –ü–∞–¥–µ–Ω–∏–µ –∞–∫—Ü–∏–π –Ω–∞ 11%

**–£—è–∑–≤–∏–º—ã–π –∫–æ–¥** (—Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è):
```python
# ‚ùå –£–Ø–ó–í–ò–ú–´–ô –ö–û–î
vendor_id = request.GET['vendor']
query = f"SELECT * FROM vendors WHERE id = {vendor_id}"
cursor.execute(query)

# –ê—Ç–∞–∫–∞: ?vendor=1 OR 1=1; DROP TABLE vendors;--
```

### üî¥ –†–µ–∞–ª—å–Ω—ã–π –ö–µ–π—Å #2: Sony PlayStation Network (2011)
**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ**:
- SQL injection –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ PSN
- –°–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ **77 –º–∏–ª–ª–∏–æ–Ω–æ–≤ –∞–∫–∫–∞—É–Ω—Ç–æ–≤**
- –°–µ—Ä–≤–∏—Å –±—ã–ª –≤—ã–∫–ª—é—á–µ–Ω –Ω–∞ **23 –¥–Ω—è**
- –û–¥–∏–Ω –∏–∑ –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö data breaches –≤ –∏—Å—Ç–æ—Ä–∏–∏

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –ü—Ä—è–º—ã–µ —É–±—ã—Ç–∫–∏: **$171 –º–∏–ª–ª–∏–æ–Ω**
- Class action lawsuit: **$15 –º–∏–ª–ª–∏–æ–Ω–æ–≤**
- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º: **$3 –º–∏–ª–ª–∏–æ–Ω–∞**
- –†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —É—â–µ—Ä–± –Ω–µ–æ—Ü–µ–Ω–∏–º

**–£—Ä–æ–∫**: SQL injection –º–æ–∂–µ—Ç —É–Ω–∏—á—Ç–æ–∂–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é.

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –†–µ—à–µ–Ω–∏—è

#### 1. Parameterized Queries (Prepared Statements)
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - PostgreSQL
import psycopg2

def get_user_by_id(user_id: int) -> dict:
    """Safely fetch user by ID using parameterized query."""
    with get_connection() as conn:
        with conn.cursor() as cur:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º %s placeholders, –ù–ï f-strings!
            cur.execute(
                "SELECT * FROM users WHERE id = %s",
                (user_id,)  # Tuple, –¥–∞–∂–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
            )
            return cur.fetchone()

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏–º–µ–Ω —Ç–∞–±–ª–∏—Ü/–∫–æ–ª–æ–Ω–æ–∫
from psycopg2 import sql

def get_count(table_name: str) -> int:
    """Count rows in table with SQL Identifier for table name."""
    with get_connection() as conn:
        with conn.cursor() as cur:
            # sql.Identifier —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –∏–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü/–∫–æ–ª–æ–Ω–æ–∫
            cur.execute(
                sql.SQL("SELECT COUNT(*) FROM {}").format(
                    sql.Identifier(table_name)
                )
            )
            return cur.fetchone()[0]
```

#### 2. ORM (SQLAlchemy, Django ORM)
```python
# ‚úÖ –û–¢–õ–ò–ß–ù–û - SQLAlchemy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç
from sqlalchemy import select
from models import User

def get_users_by_email(email: str) -> List[User]:
    """Fetch users by email using SQLAlchemy ORM."""
    stmt = select(User).where(User.email == email)
    return session.execute(stmt).scalars().all()

# SQLAlchemy —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:
# SELECT * FROM users WHERE email = %s
# –ò –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–¥–∞—Å—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä
```

#### 3. Input Validation + Whitelist
```python
# ‚úÖ –ó–ê–©–ò–¢–ê –í –ì–õ–£–ë–ò–ù–£
from enum import Enum

class AllowedTables(Enum):
    """Whitelist —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü."""
    USERS = "users"
    TRACKS = "tracks"
    ARTISTS = "artists"

def get_table_stats(table: AllowedTables) -> dict:
    """Get statistics with validated table name."""
    if not isinstance(table, AllowedTables):
        raise ValueError(f"Invalid table: {table}")

    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(
                sql.SQL("SELECT COUNT(*) FROM {}").format(
                    sql.Identifier(table.value)
                )
            )
            return {"table": table.value, "count": cur.fetchone()[0]}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
stats = get_table_stats(AllowedTables.USERS)  # ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ
stats = get_table_stats("users; DROP TABLE users;--")  # ‚ùå Raise ValueError
```

### üí° –í–æ–ø—Ä–æ—Å—ã –Ω–∞ –°–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

**Q1**: "–û–±—ä—è—Å–Ω–∏—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É parameterized queries –∏ ORM. –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –ø–æ–¥—Ö–æ–¥?"

<details>
<summary>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –û—Ç–≤–µ—Ç</summary>

**Parameterized Queries (Prepared Statements)**:

*–ü–ª—é—Å—ã*:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ SQL
- –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ù–µ—Ç overhead –æ—Ç ORM

*–ú–∏–Ω—É—Å—ã*:
- –ë–æ–ª—å—à–µ boilerplate –∫–æ–¥–∞
- –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞–º–∏
- –õ–µ–≥–∫–æ —Å–¥–µ–ª–∞—Ç—å –æ—à–∏–±–∫—É

*–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å*:
- High-performance —Å–∏—Å—Ç–µ–º—ã (>10K QPS)
- –°–ª–æ–∂–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ SQL
- Data warehousing, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –ú–∏–≥—Ä–∞—Ü–∏—è legacy —Å–∏—Å—Ç–µ–º

**ORM (Object-Relational Mapping)**:

*–ü–ª—é—Å—ã*:
- Type safety –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection
- –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∫–æ–¥
- Database agnostic
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

*–ú–∏–Ω—É—Å—ã*:
- Performance overhead (5-15%)
- N+1 query problem
- –°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ—É–¥–æ–±–Ω—ã
- "Magic" –º–æ–∂–µ—Ç —Å–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

*–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å*:
- CRUD –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (90% —Å–ª—É—á–∞–µ–≤)
- –ë—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ MVP
- –ö–æ–º–∞–Ω–¥–∞ junior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- Multi-database –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**Hybrid –ø–æ–¥—Ö–æ–¥** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```python
from sqlalchemy import text

# –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã - ORM
users = session.query(User).filter_by(email=email).all()

# –°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã - Raw SQL —á–µ—Ä–µ–∑ ORM
result = session.execute(
    text("""
        SELECT u.id, COUNT(t.id) as track_count
        FROM users u
        LEFT JOIN tracks t ON u.id = t.user_id
        WHERE u.created_at > :start_date
        GROUP BY u.id
        HAVING COUNT(t.id) > :min_tracks
    """),
    {"start_date": start_date, "min_tracks": 10}
)
```
</details>

**Q2**: "–í–∞—à –∫–æ–¥ –ø—Ä–æ—à–µ–ª code review, –Ω–æ QA –Ω–∞—à–µ–ª SQL injection. –ö–∞–∫ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ –∏ —á—Ç–æ –¥–µ–ª–∞—Ç—å?"

<details>
<summary>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –û—Ç–≤–µ—Ç</summary>

**–ö–∞–∫ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ**:

1. **Code Review –Ω–µ –ø–æ–∫—Ä—ã–ª –≤—Å–µ edge cases**:
```python
# –í—ã–≥–ª—è–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ —É—è–∑–≤–∏–º–æ!
def search_users(sort_by: str = "name"):
    # ‚ùå sort_by –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è!
    query = f"SELECT * FROM users ORDER BY {sort_by}"
    return db.execute(query)

# –ê—Ç–∞–∫–∞: search_users(sort_by="id; DROP TABLE users;--")
```

2. **Second-order SQL Injection**:
```python
# –®–∞–≥ 1: –ë–µ–∑–æ–ø–∞—Å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
username = "admin'--"
db.execute("INSERT INTO users (name) VALUES (%s)", (username,))

# –®–∞–≥ 2: –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ —á–∏—Ç–∞–µ–º (–≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ –∫–æ–¥–∞)
user = db.fetchone("SELECT name FROM users WHERE id = 1")
# ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º –∑–∞–ø—Ä–æ—Å–µ
db.execute(f"SELECT * FROM posts WHERE author = '{user['name']}'")
# –†–µ–∑—É–ª—å—Ç–∞—Ç: SELECT * FROM posts WHERE author = 'admin'--'
```

3. **NoSQL Injection** (—Ç–æ–∂–µ SQL Injection!):
```python
# MongoDB - —Ç–æ–∂–µ —É—è–∑–≤–∏–º!
username = {"$ne": None}  # –í–µ—Ä–Ω–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
db.users.find({"username": username})
```

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å**:

**–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ**:
1. Hotfix –∏ deploy
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ exploits
3. Security incident protocol

**Systematically**:
```python
# 1. Static Analysis
# –î–æ–±–∞–≤–∏—Ç—å –≤ CI/CD: bandit, semgrep
# .bandit config:
# B608: Hardcoded SQL strings
# B201: Flask debug mode

# 2. Dynamic Analysis (DAST)
# –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å OWASP ZAP –≤ staging tests

# 3. Input Validation Layer
from pydantic import BaseModel, validator

class SearchParams(BaseModel):
    sort_by: str
    order: str

    @validator('sort_by')
    def validate_sort(cls, v):
        allowed = ['name', 'email', 'created_at']
        if v not in allowed:
            raise ValueError(f'Invalid sort field: {v}')
        return v

    @validator('order')
    def validate_order(cls, v):
        if v.upper() not in ['ASC', 'DESC']:
            raise ValueError('Order must be ASC or DESC')
        return v.upper()

# 4. WAF (Web Application Firewall)
# AWS WAF, Cloudflare, ModSecurity
# –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–∏–ø–∏—á–Ω—ã–µ SQL injection –ø–∞—Ç—Ç–µ—Ä–Ω—ã

# 5. Database Permissions
# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å DROP, CREATE –ø—Ä–∞–≤–∞!
GRANT SELECT, INSERT, UPDATE, DELETE ON database.* TO 'app_user'@'%';
-- –ù–ï –¥–∞–≤–∞—Ç—å: DROP, CREATE, ALTER, GRANT
```

**–ü—Ä–æ—Ü–µ—Å—Å —É–ª—É—á—à–µ–Ω–∏—è**:
1. **Security Training** –¥–ª—è –≤—Å–µ–π –∫–æ–º–∞–Ω–¥—ã
2. **Security Champions** –≤ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥–µ
3. **Threat Modeling** –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∏—á
4. **Penetration Testing** —Ä–∞–∑ –≤ –∫–≤–∞—Ä—Ç–∞–ª
5. **Bug Bounty Program**
</details>

---

## 3. Missing Type Hints

### üìñ –¢–µ–æ—Ä–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Ç–∏–ø–æ–≤ –≤ Python –∫–æ–¥–µ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç:
- –†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- Onboarding –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- IDE autocomplete

**–í FAANG —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ** –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –ö–æ–¥–±–µ–π–∑—ã –º–∏–ª–ª–∏–æ–Ω—ã —Å—Ç—Ä–æ–∫
- –°–æ—Ç–Ω–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –¶–µ–Ω–∞ –æ—à–∏–±–∫–∏ –≤ production –æ–≥—Ä–æ–º–Ω–∞

### üî¥ –†–µ–∞–ª—å–Ω—ã–π –ö–µ–π—Å: Dropbox Migration to Type Hints (2019)
**–ö–æ–Ω—Ç–µ–∫—Å—Ç**:
- Dropbox –∏–º–µ–ª **4 –º–∏–ª–ª–∏–æ–Ω–∞ —Å—Ç—Ä–æ–∫ Python –∫–æ–¥–∞**
- –ë–æ–ª–µ–µ **1000 –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤**
- –ë–µ–∑ type hints - –æ—à–∏–±–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–ª–∏—Å—å –≤ production

**–ß—Ç–æ —Å–¥–µ–ª–∞–ª–∏**:
- –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Python 3 —Å type hints
- –í–Ω–µ–¥—Ä–µ–Ω–∏–µ mypy –≤ CI/CD
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ type hints –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã** (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞):
- **15% reduction** –≤ production bugs
- **20% faster** onboarding –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- **40% improvement** –≤ IDE performance
- **–°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ 1000+ —á–∞—Å–æ–≤** –Ω–∞ debugging –≤ –≥–æ–¥

**–¶–∏—Ç–∞—Ç–∞ CTO Dropbox**:
> "Type hints are the single most impactful change we made to our Python codebase. The ROI is incredible."

### üî¥ –†–µ–∞–ª—å–Ω—ã–π –ö–µ–π—Å: Instagram (Meta) - Python Typing

**–ö–æ–Ω—Ç–µ–∫—Å—Ç**:
- Instagram - –æ–¥–∏–Ω –∏–∑ –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö Python –ø—Ä–æ–µ–∫—Ç–æ–≤ (–æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ Django)
- **–ú–∏–ª–ª–∏–æ–Ω—ã —Å—Ç—Ä–æ–∫** Python –∫–æ–¥–∞
- –ü—Ä–æ–±–ª–µ–º–∞: runtime –æ—à–∏–±–∫–∏ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ** (2018):
```python
# ‚ùå –†–µ–∞–ª—å–Ω—ã–π –±–∞–≥ –≤ Instagram (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
def get_user_followers(user_id):
    # –ò–Ω–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ int, –∏–Ω–æ–≥–¥–∞ str
    followers = cache.get(f"followers:{user_id}")
    # Bug: –∫–æ–≥–¥–∞ followers = None, –¥–∞–ª—å—à–µ –ø–∞–¥–∞–ª–æ
    return followers.split(",")  # AttributeError –≤ production!
```

**–†–µ—à–µ–Ω–∏–µ Instagram**:
- –°–æ–∑–¥–∞–ª–∏ **Pyre** - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π type checker
- Open-sourced –≤ 2018
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ–≥–æ –∫–æ–¥–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
- **70% reduction** –≤ type-related bugs
- Type checker –Ω–∞—Ö–æ–¥–∏—Ç **—Å–æ—Ç–Ω–∏ –æ—à–∏–±–æ–∫** –¥–æ production
- Improved developer confidence

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Type Hints

```python
from typing import Optional, Dict, Any, List, Union, Tuple
from pathlib import Path
import psycopg2
from psycopg2.extensions import connection as PgConnection

class PostgreSQLDiagnostics:
    """PostgreSQL database diagnostics tool.

    Attributes:
        project_root: Root directory of the project.
        conn: Active PostgreSQL connection or None.
        db_config: Database connection configuration.
    """

    def __init__(
        self,
        db_config: Optional[Dict[str, Any]] = None,
        logger: Optional[logging.Logger] = None
    ) -> None:
        """Initialize diagnostics with optional config.

        Args:
            db_config: Database connection parameters.
            logger: Logger instance for diagnostics output.
        """
        self.project_root: Path = Path(__file__).parent.parent.parent
        self.conn: Optional[PgConnection] = None
        self.db_config: Dict[str, Any] = db_config or self._load_db_config()
        self.logger: logging.Logger = logger or logging.getLogger(__name__)

    def connect(self) -> bool:
        """Establish connection to PostgreSQL.

        Returns:
            True if connection successful, False otherwise.

        Raises:
            psycopg2.OperationalError: If all connection attempts fail.
        """
        try:
            self.conn = psycopg2.connect(**self.db_config)
            self.conn.autocommit = True
            self.logger.info("Connected to PostgreSQL successfully")
            return True
        except psycopg2.OperationalError as e:
            self.logger.error(f"Connection failed: {e}", exc_info=True)
            return False

    def find_unanalyzed(
        self,
        limit: int = 10,
        offset: int = 0
    ) -> List[Dict[str, Union[int, str]]]:
        """Find tracks without AI analysis.

        Args:
            limit: Maximum number of tracks to return (1-1000).
            offset: Number of tracks to skip.

        Returns:
            List of dicts with keys: id (int), artist (str), title (str).

        Raises:
            ValueError: If limit is out of valid range.
            psycopg2.Error: If database query fails.
        """
        if not 1 <= limit <= 1000:
            raise ValueError(f"Limit must be 1-1000, got {limit}")

        # Implementation...
        return []

    def _table_exists(self, table_name: str) -> bool:
        """Check if table exists in database.

        Args:
            table_name: Name of table to check.

        Returns:
            True if table exists, False otherwise.
        """
        # Implementation...
        return False
```

### üí° –í–æ–ø—Ä–æ—Å—ã –Ω–∞ –°–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

**Q1**: "–ö–∞–∫–∏–µ type hints –≤—ã –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∫–∞–∫ filepath (str), —Ç–∞–∫ –∏ file object?"

<details>
<summary>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –û—Ç–≤–µ—Ç</summary>

```python
from typing import Union, TextIO, BinaryIO
from pathlib import Path
from typing import Protocol

# –í–∞—Ä–∏–∞–Ω—Ç 1: Union (–ø—Ä–æ—Å—Ç–æ–π)
def read_data(source: Union[str, Path, TextIO]) -> str:
    """Read data from file path or file object."""
    if isinstance(source, (str, Path)):
        with open(source, 'r') as f:
            return f.read()
    else:
        return source.read()

# –í–∞—Ä–∏–∞–Ω—Ç 2: Protocol (advanced, Google style)
from typing import Protocol

class ReadableFile(Protocol):
    """Protocol for file-like objects with read method."""
    def read(self) -> str: ...

def read_data_advanced(source: Union[str, Path, ReadableFile]) -> str:
    """Read data from path or readable file-like object."""
    if isinstance(source, (str, Path)):
        with open(source, 'r') as f:
            return f.read()
    return source.read()

# –í–∞—Ä–∏–∞–Ω—Ç 3: PathLike (Python 3.6+)
from os import PathLike

def read_data_pathlike(
    source: Union[str, PathLike, TextIO]
) -> str:
    """Read using os.PathLike protocol."""
    if isinstance(source, (str, PathLike)):
        with open(source, 'r') as f:
            return f.read()
    return source.read()

# –í–∞—Ä–∏–∞–Ω—Ç 4: Overload (—Å–∞–º—ã–π —Ç–æ—á–Ω—ã–π)
from typing import overload

@overload
def read_data_overload(source: Union[str, Path]) -> str: ...

@overload
def read_data_overload(source: TextIO) -> str: ...

def read_data_overload(source):
    """Read data with precise type hints using overload."""
    if isinstance(source, (str, Path)):
        with open(source, 'r') as f:
            return f.read()
    return source.read()
```

**–ù–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏ –≤ Google –æ–∂–∏–¥–∞—é—Ç**:
- –ó–Ω–∞–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É Union –∏ Optional
- –ü–æ–Ω–∏–º–∞–Ω–∏–µ Protocol (duck typing)
- Awareness –æ overload –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ trade-offs –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
</details>

**Q2**: "–ö–∞–∫ –±—ã –≤—ã –¥–æ–±–∞–≤–∏–ª–∏ type hints –≤ legacy codebase –Ω–∞ 100K —Å—Ç—Ä–æ–∫ –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏?"

<details>
<summary>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –û—Ç–≤–µ—Ç</summary>

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ—ç—Ç–∞–ø–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏** (–ø–æ –æ–ø—ã—Ç—É Dropbox –∏ Instagram):

**Phase 1: Setup (Week 1)**
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å mypy
pip install mypy

# 2. –°–æ–∑–¥–∞—Ç—å mypy.ini —Å –º—è–≥–∫–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
# mypy.ini
[mypy]
python_version = 3.9
warn_return_any = False
warn_unused_configs = True
disallow_untyped_defs = False  # –ü–æ–∫–∞ False!
ignore_missing_imports = True  # –î–ª—è legacy libs

# 3. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–±—É–¥–µ—Ç –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ - —ç—Ç–æ –æ–∫)
mypy src/  # Baseline: 5000 –æ—à–∏–±–æ–∫

# 4. –°–æ–∑–¥–∞—Ç—å baseline
mypy src/ > mypy_baseline.txt
```

**Phase 2: New Code Only (Week 2-4)**
```python
# pre-commit hook (.pre-commit-config.yaml)
repos:
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v0.991
    hooks:
      - id: mypy
        args: [--strict]  # –°—Ç—Ä–æ–≥–æ –¥–ª—è –ù–û–í–û–ì–û –∫–æ–¥–∞
        files: ^(–Ω–æ–≤—ã–µ_–º–æ–¥—É–ª–∏|src/new)/  # –¢–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
```

**Phase 3: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ú–æ–¥—É–ª–∏ (Month 2-3)**
```python
# –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
priority_modules = [
    'src/auth/',       # Authentication - –∫—Ä–∏—Ç–∏—á–Ω–æ!
    'src/payment/',    # Payments - –∫—Ä–∏—Ç–∏—á–Ω–æ!
    'src/database/',   # DB layer - –∫—Ä–∏—Ç–∏—á–Ω–æ!
    'src/api/endpoints/',  # Public API
]

# –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ strict checks
# mypy.ini
[mypy-src.auth.*]
disallow_untyped_defs = True
disallow_any_generics = True

[mypy-src.payment.*]
disallow_untyped_defs = True
```

**Phase 4: Automated Migration (Month 4-6)**
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

# 1. MonkeyType (runtime type collector)
pip install MonkeyType
# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã —Å MonkeyType
monkeytype run -m pytest tests/
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º stubs
monkeytype apply src.module

# 2. PyAnnotate (Facebook tool)
pip install pyannotate
# –°–æ–±–∏—Ä–∞–µ–º —Ç–∏–ø—ã –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
pyannotate --type-info type_info.json src/

# 3. auto-optional (–¥–ª—è Optional —Ç–∏–ø–æ–≤)
pip install auto-optional
auto-optional src/
```

**Phase 5: Team Training (Ongoing)**
```python
# Code review checklist
CHECKLIST = """
‚úÖ All new functions have type hints
‚úÖ Return type specified
‚úÖ Complex types use typing module
‚úÖ mypy passes on new code
‚úÖ Docstring includes Args, Returns, Raises
"""

# Weekly brown bag sessions
# "Type Hints Best Practices"
# "Common mypy Errors and Solutions"
# "Generic Types Deep Dive"
```

**Phase 6: Metrics & Incentives (Month 6+)**
```python
# –¢—Ä–µ–∫–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
import ast
from pathlib import Path

def calculate_type_coverage(directory: Path) -> float:
    """Calculate percentage of functions with type hints."""
    total_funcs = 0
    typed_funcs = 0

    for py_file in directory.rglob("*.py"):
        tree = ast.parse(py_file.read_text())
        for node in ast.walk(tree):
            if isinstance(node, ast.FunctionDef):
                total_funcs += 1
                if node.returns is not None:
                    typed_funcs += 1

    return (typed_funcs / total_funcs * 100) if total_funcs > 0 else 0

# Dashboard metrics
print(f"Type Coverage: {calculate_type_coverage(Path('src'))}%")
# Week 1: 5%
# Month 3: 40%
# Month 6: 75%
# Year 1: 95%
```

**Timeline** (100K LOC):
- Month 1-2: Infrastructure + New Code
- Month 3-4: Critical Modules (20% codebase)
- Month 5-8: Core Modules (60% codebase)
- Month 9-12: Long Tail (20% codebase)
- **Total: 1 year** –¥–ª—è 100K —Å—Ç—Ä–æ–∫

**Key Metrics to Track**:
- Type coverage %
- mypy error count
- Bugs caught by mypy in CI
- Time saved on debugging
</details>

---

# üéØ –ß–ê–°–¢–¨ 2: –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

## 4. Single Responsibility Principle (SRP) Violation

### üìñ –¢–µ–æ—Ä–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–ª–∞—Å—Å –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–ª–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ä–∞–∑–Ω—ã—Ö –≤–µ—â–µ–π.

**–ü—Ä–∏–∑–Ω–∞–∫–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è SRP**:
- –ú–µ—Ç–æ–¥—ã >50-100 —Å—Ç—Ä–æ–∫
- –ö–ª–∞—Å—Å –∏–º–µ–µ—Ç >10 public –º–µ—Ç–æ–¥–æ–≤
- –ö–ª–∞—Å—Å –∏–º–µ–µ—Ç >5 dependencies
- –°–ª–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å unit test
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–π —Ñ–∏—á–µ –ª–æ–º–∞–µ—Ç –¥—Ä—É–≥—É—é

### üî¥ –†–µ–∞–ª—å–Ω—ã–π –ö–µ–π—Å: Healthcare.gov Launch (2013)

**–ö–æ–Ω—Ç–µ–∫—Å—Ç**:
- –ó–∞–ø—É—Å–∫ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –°–®–ê
- –ë—é–¥–∂–µ—Ç: **$1.7 billion**
- –û–∂–∏–¥–∞–µ–º–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: 60,000 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–∞–π—Ç —É–ø–∞–ª –≤ –ø–µ—Ä–≤—ã–π –∂–µ –¥–µ–Ω—å

**–ß—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫**:
```python
# ‚ùå –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ–±–ª–µ–º—ã
class UserEnrollmentService:
    """God Object - –¥–µ–ª–∞–µ—Ç –í–°–ï!"""

    def enroll_user(self, user_data):
        # 1. –í–∞–ª–∏–¥–∞—Ü–∏—è (200 —Å—Ç—Ä–æ–∫)
        if not self._validate_ssn(user_data['ssn']):
            return False
        if not self._validate_income(user_data['income']):
            return False
        # ... 15 –¥—Ä—É–≥–∏—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–π

        # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ eligibility (300 —Å—Ç—Ä–æ–∫)
        if not self._check_citizenship(user_data):
            return False
        if not self._check_state_eligibility(user_data):
            return False
        # ... 10 –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

        # 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 10+ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (500 —Å—Ç—Ä–æ–∫)
        self._query_irs_database(user_data)
        self._query_social_security(user_data)
        self._query_immigration(user_data)
        # ... 7 –¥—Ä—É–≥–∏—Ö API calls

        # 4. –†–∞—Å—á–µ—Ç subsidies (400 —Å—Ç—Ä–æ–∫)
        # ... —Å–ª–æ–∂–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

        # 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (100 —Å—Ç—Ä–æ–∫)
        # ...

        # 6. –û—Ç–ø—Ä–∞–≤–∫–∞ email (50 —Å—Ç—Ä–æ–∫)
        # ...

        # –ò—Ç–æ–≥–æ: >1500 —Å—Ç—Ä–æ–∫ –≤ –û–î–ù–û–ú –º–µ—Ç–æ–¥–µ!
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –°–∞–π—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–ª **–Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–¥–µ–ª—å**
- –¢–æ–ª—å–∫–æ **6 —á–µ–ª–æ–≤–µ–∫** —Å–º–æ–≥–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å (–≤–º–µ—Å—Ç–æ —Ç—ã—Å—è—á)
- –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ **$1 billion** –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–∫–∞–Ω–¥–∞–ª

**Root Cause**:
- Tight coupling –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –±—ã–ª–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏
- –û–¥–∏–Ω failed API call —Ä–æ–Ω—è–ª –≤—Å—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ã–ª–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –†–µ—à–µ–Ω–∏–µ: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

```python
from abc import ABC, abstractmethod
from typing import Protocol
from dataclasses import dataclass

# 1. Value Objects
@dataclass(frozen=True)
class UserData:
    """Immutable user data."""
    ssn: str
    income: int
    state: str
    citizenship_status: str

@dataclass(frozen=True)
class EligibilityResult:
    """Result of eligibility check."""
    is_eligible: bool
    reasons: List[str]
    subsidy_amount: Optional[int] = None

# 2. Single Responsibility Services

class IValidator(Protocol):
    """Protocol for validators."""
    def validate(self, data: UserData) -> bool:
        ...

class SSNValidator:
    """Validates Social Security Numbers."""
    def validate(self, data: UserData) -> bool:
        return len(data.ssn) == 9 and data.ssn.isdigit()

class IncomeValidator:
    """Validates income data."""
    def __init__(self, min_income: int, max_income: int):
        self.min_income = min_income
        self.max_income = max_income

    def validate(self, data: UserData) -> bool:
        return self.min_income <= data.income <= self.max_income

class ValidationService:
    """Orchestrates validation - SINGLE responsibility."""
    def __init__(self, validators: List[IValidator]):
        self.validators = validators

    def validate_all(self, data: UserData) -> Tuple[bool, List[str]]:
        errors = []
        for validator in self.validators:
            if not validator.validate(data):
                errors.append(f"{validator.__class__.__name__} failed")
        return len(errors) == 0, errors

# 3. External Service Integration (—Å Circuit Breaker!)

class ExternalServiceClient(ABC):
    """Base class for external API clients."""

    @abstractmethod
    def query(self, data: UserData) -> Dict[str, Any]:
        pass

class IRSClient(ExternalServiceClient):
    """IRS API client - SINGLE responsibility."""

    def __init__(self, api_key: str, timeout: int = 30):
        self.api_key = api_key
        self.timeout = timeout
        self.circuit_breaker = CircuitBreaker()

    @retry(stop=stop_after_attempt(3), wait=wait_exponential())
    def query(self, data: UserData) -> Dict[str, Any]:
        """Query IRS with retry and circuit breaker."""
        if self.circuit_breaker.is_open():
            return {"status": "unavailable"}

        try:
            response = requests.post(
                "https://irs.gov/api/verify",
                json={"ssn": data.ssn},
                timeout=self.timeout
            )
            return response.json()
        except RequestException as e:
            self.circuit_breaker.record_failure()
            raise

# 4. Business Logic Service

class EligibilityService:
    """Determines eligibility - SINGLE responsibility."""

    def __init__(
        self,
        irs_client: IRSClient,
        subsidy_calculator: SubsidyCalculator
    ):
        self.irs_client = irs_client
        self.subsidy_calculator = subsidy_calculator

    def check_eligibility(self, data: UserData) -> EligibilityResult:
        """Check if user is eligible for healthcare."""
        reasons = []

        # Citizenship check
        if data.citizenship_status not in ['citizen', 'permanent_resident']:
            reasons.append("Citizenship requirement not met")
            return EligibilityResult(False, reasons)

        # Income check via IRS
        irs_data = self.irs_client.query(data)
        if not irs_data.get('income_verified'):
            reasons.append("Income verification failed")
            return EligibilityResult(False, reasons)

        # Calculate subsidy
        subsidy = self.subsidy_calculator.calculate(data.income)

        return EligibilityResult(True, [], subsidy)

# 5. Orchestrator (–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä)

class EnrollmentOrchestrator:
    """Orchestrates enrollment process - delegates to specialists."""

    def __init__(
        self,
        validation_service: ValidationService,
        eligibility_service: EligibilityService,
        enrollment_repository: EnrollmentRepository,
        notification_service: NotificationService
    ):
        self.validation_service = validation_service
        self.eligibility_service = eligibility_service
        self.enrollment_repository = enrollment_repository
        self.notification_service = notification_service

    async def enroll_user(self, user_data: UserData) -> EnrollmentResult:
        """Enroll user by orchestrating services."""

        # Step 1: Validate
        is_valid, errors = self.validation_service.validate_all(user_data)
        if not is_valid:
            return EnrollmentResult(success=False, errors=errors)

        # Step 2: Check eligibility
        eligibility = self.eligibility_service.check_eligibility(user_data)
        if not eligibility.is_eligible:
            return EnrollmentResult(success=False, reasons=eligibility.reasons)

        # Step 3: Save to database
        enrollment_id = await self.enrollment_repository.save(
            user_data, eligibility
        )

        # Step 4: Send notification (async, non-blocking)
        await self.notification_service.send_confirmation(
            enrollment_id, user_data
        )

        return EnrollmentResult(success=True, enrollment_id=enrollment_id)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è**:
- ‚úÖ –ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å <100 —Å—Ç—Ä–æ–∫
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (mock dependencies)
- ‚úÖ –ú–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### üí° –í–æ–ø—Ä–æ—Å—ã –Ω–∞ –°–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

**Q1**: "–£ –≤–∞—Å –µ—Å—Ç—å –∫–ª–∞—Å—Å DatabaseManager —Å 30 –º–µ—Ç–æ–¥–∞–º–∏. –ö–∞–∫ –≤—ã –µ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç–µ?"

<details>
<summary>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –û—Ç–≤–µ—Ç (Google-style)</summary>

**–®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑**
```python
# ‚ùå God Object
class DatabaseManager:
    # Connection management (5 –º–µ—Ç–æ–¥–æ–≤)
    def connect(self): ...
    def disconnect(self): ...
    def get_connection(self): ...
    def retry_connection(self): ...
    def check_health(self): ...

    # Query execution (8 –º–µ—Ç–æ–¥–æ–≤)
    def execute(self): ...
    def execute_many(self): ...
    def fetch_one(self): ...
    def fetch_all(self): ...
    def execute_transaction(self): ...
    # ...

    # Migrations (4 –º–µ—Ç–æ–¥–∞)
    def run_migration(self): ...
    def rollback_migration(self): ...
    def get_migration_status(self): ...
    def create_migration(self): ...

    # Monitoring (6 –º–µ—Ç–æ–¥–æ–≤)
    def get_stats(self): ...
    def get_slow_queries(self): ...
    def explain_query(self): ...
    # ...

    # Backup (4 –º–µ—Ç–æ–¥–∞)
    def create_backup(self): ...
    def restore_backup(self): ...
    # ...

    # Cache (3 –º–µ—Ç–æ–¥–∞)
    def cache_query(self): ...
    def invalidate_cache(self): ...
    def get_from_cache(self): ...
```

**–®–∞–≥ 2: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**

```python
# ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

# 1. Connection Management
class ConnectionPool:
    """Manages database connection pool."""

    def __init__(self, config: DbConfig):
        self.pool = psycopg2.pool.ThreadedConnectionPool(
            minconn=1,
            maxconn=20,
            **config.dict()
        )

    def get_connection(self) -> connection:
        return self.pool.getconn()

    def return_connection(self, conn: connection) -> None:
        self.pool.putconn(conn)

    def close_all(self) -> None:
        self.pool.closeall()

# 2. Query Execution
class QueryExecutor:
    """Executes database queries."""

    def __init__(self, connection_pool: ConnectionPool):
        self.pool = connection_pool

    def execute_one(self, query: str, params: tuple) -> Dict:
        with self.pool.get_connection() as conn:
            with conn.cursor(cursor_factory=RealDictCursor) as cur:
                cur.execute(query, params)
                return cur.fetchone()

    def execute_many(self, query: str, params_list: List[tuple]) -> int:
        with self.pool.get_connection() as conn:
            with conn.cursor() as cur:
                cur.executemany(query, params_list)
                return cur.rowcount

# 3. Transaction Management
class TransactionManager:
    """Manages database transactions."""

    def __init__(self, connection_pool: ConnectionPool):
        self.pool = connection_pool

    @contextmanager
    def transaction(self):
        """Context manager for transactions."""
        conn = self.pool.get_connection()
        try:
            yield conn
            conn.commit()
        except Exception:
            conn.rollback()
            raise
        finally:
            self.pool.return_connection(conn)

# 4. Migration Runner
class MigrationRunner:
    """Runs database migrations."""

    def __init__(self, executor: QueryExecutor):
        self.executor = executor
        self.migrations_dir = Path("migrations")

    def run_pending(self) -> List[str]:
        """Run all pending migrations."""
        applied = self._get_applied_migrations()
        pending = self._get_pending_migrations(applied)

        for migration in pending:
            self._run_migration(migration)

        return pending

# 5. Query Performance Monitor
class QueryMonitor:
    """Monitors query performance."""

    def __init__(self, executor: QueryExecutor):
        self.executor = executor

    def get_slow_queries(self, threshold_ms: int = 1000) -> List[Dict]:
        """Get queries slower than threshold."""
        return self.executor.execute_many(
            """
            SELECT query, mean_exec_time, calls
            FROM pg_stat_statements
            WHERE mean_exec_time > %s
            ORDER BY mean_exec_time DESC
            LIMIT 100
            """,
            (threshold_ms,)
        )

# 6. Backup Service
class BackupService:
    """Handles database backups."""

    def __init__(self, db_config: DbConfig):
        self.db_config = db_config

    def create_backup(self, backup_path: Path) -> None:
        """Create database backup using pg_dump."""
        subprocess.run([
            "pg_dump",
            "-h", self.db_config.host,
            "-U", self.db_config.user,
            "-d", self.db_config.database,
            "-F", "c",  # Custom format
            "-f", str(backup_path)
        ], check=True)

# 7. Query Cache
class QueryCache:
    """Caches query results."""

    def __init__(self, redis_client: Redis):
        self.redis = redis_client
        self.ttl = 3600  # 1 hour

    def get(self, key: str) -> Optional[Any]:
        """Get cached result."""
        data = self.redis.get(key)
        return json.loads(data) if data else None

    def set(self, key: str, value: Any, ttl: int = None) -> None:
        """Cache query result."""
        self.redis.setex(
            key,
            ttl or self.ttl,
            json.dumps(value)
        )

# 8. Facade (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
class DatabaseFacade:
    """Facade providing backward-compatible interface."""

    def __init__(self, config: DbConfig):
        self.connection_pool = ConnectionPool(config)
        self.executor = QueryExecutor(self.connection_pool)
        self.transaction_manager = TransactionManager(self.connection_pool)
        self.migration_runner = MigrationRunner(self.executor)
        self.monitor = QueryMonitor(self.executor)
        self.backup_service = BackupService(config)
        self.cache = QueryCache(redis_client)

    # –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º
    def execute(self, query: str, params: tuple) -> Dict:
        return self.executor.execute_one(query, params)

    def run_migrations(self) -> List[str]:
        return self.migration_runner.run_pending()

    # ... –∏ —Ç.–¥.
```

**–®–∞–≥ 3: Migration Path**

```python
# –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
# 1. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã
# 2. DatabaseManager –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∫ –Ω–∏–º
# 3. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ–≤–æ–¥–∏–º –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã
# 4. Deprecate —Å—Ç–∞—Ä—ã–π DatabaseManager

# Old code (–±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å)
db_manager = DatabaseManager()
result = db_manager.execute("SELECT * FROM users")

# New code (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
facade = DatabaseFacade(config)
result = facade.executor.execute_one("SELECT * FROM users", ())
```

**–ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞**:
- –ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å <200 —Å—Ç—Ä–æ–∫
- –ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –∏–º–µ–µ—Ç 1 –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
- Unit test coverage >80%
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
</details>

---

–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ —à–ø–∞—Ä–≥–∞–ª–∫–∏? –°–ª–µ–¥—É—é—â–∏–µ —Ç–µ–º—ã:
- Code Duplication –∏ DRY –ø—Ä–∏–Ω—Ü–∏–ø
- Exception Handling Best Practices
- Logging vs Print
- Performance Optimization (—Å –∫–µ–π—Å–∞–º–∏ Netflix, Spotify)
- Testing Strategies
- Database Best Practices

–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?